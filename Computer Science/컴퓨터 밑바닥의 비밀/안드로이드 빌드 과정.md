# 안드로이드 빌드 과정

빌드(build)는 소스 코드와 리소스를 실제로 실행 가능한 앱 파일(APK)로 변환하는 과정이다. 

1. 소스 코드 컴파일: **Kotlin이나 Java로 작성된 소스 코드를 컴파일하여 JVM 바이트코드(.class 파일)로 변환**한다: Java 컴파일러(javac)나 Kotlin 컴파일러(kotlinc)는 JVM 위에서 동작하여 소스 코드를 바이트코드(.class 파일)로 변환한다. 이 단계에서 JVM은 개발자의 소스 코드를 기계가 이해할 수 있는 중간 형태(바이트코드)로 변환하는 중요한 역할을 한다. 
2. 리소스 처리: 앱에서 사용하는 **이미지, 레이아웃 XML 파일, 문자열 리소스 등 리소스 파일들이 바이너리 형식으로 변환**된다.
3. Dex 파일 생성: **여러 개의 .class 파일들을 Dalvik 또는 ART(안드로이드 런타임)에서 실행할 수 있는 .dex(DEX) 파일로 변환**한다. DEX 파일은 안드로이드 장치에서 실행될 수 있는 형태의 바이트코드이다.
4. APK 패키징: **컴파일된 코드(Dex 파일), 리소스, 메타데이터(AndroidManifest.xml 등)를 포함하여 하나의 APK 파일로 패키징**한다.
5. **서명(Signing)**: APK 파일은 개발자의 키로 서명되고, 서명된 APK 파일은 Google Play에 업로드하거나 디바이스에 설치할 수 있다.
6. 디버그 또는 릴리즈 빌드: 개발 중에는 디버그 빌드를 통해 테스트하며, 최종 사용자에게 배포하기 위해서는 최적화된 릴리즈 빌드를 생성한다. 릴리즈 빌드는 ProGuard를 사용하여 코드 난독화 및 최적화 작업이 추가로 수행될 수 있다.

빌드는 앱 개발의 필수 과정으로, 최종 사용자에게 배포할 수 있는 형태로 앱을 준비하는 과정이다. Android Studio에서는 Gradle이 이 빌드 과정을 자동으로 관리해 주기 때문에, 개발자는 필요한 설정만 맞추면 쉽게 빌드를 진행할 수 있다. Gradle은 JVM 기반 도구로, 빌드 스크립트를 실행하여 프로젝트를 컴파일, 패키징, 테스트, 배포 등 다양한 작업을 자동화한다. Gradle은 JVM에서 실행되므로, 프로젝트 빌드 과정 전체가 JVM에서 처리된다. Gradle은 소스 코드를 컴파일하고, 리소스를 처리하며, 최종적으로 DEX 파일을 생성하는 등의 빌드 과정을 조정한다.

## 안드로이드 빌드 과정에서의 링크
안드로이드 빌드 과정에서 "링커"라는 전통적인 개념의 역할은 사실상 존재하지 않는다. 대신, 안드로이드 빌드 과정에서 링커와 비슷한 기능을 수행하는 다른 도구와 과정이 있다. 전통적인 링커는 여러 개의 오브젝트 파일(.o 파일)을 결합하여 하나의 실행 파일 또는 라이브러리를 생성하는 역할을 한다. 이 과정에서 링커는 다음과 같은 작업을 수행한다: 1) **심벌 해석(Symbol Resolution)**: 서로 다른 파일에서 참조하는 함수와 변수를 올바르게 결합한다. 2) **주소 할당(Address Assignment)**: 프로그램의 메모리 레이아웃을 결정하고, 각 심벌에 메모리 주소를 할당한다. 3) **파일 결합**: 여러 개의 오브젝트 파일을 하나의 실행 가능한 바이너리 파일로 결합한다.

안드로이드에서의 빌드 과정에서의 코드와 리소스를 결합하는 작업:

1. **Kotlin/Java 컴파일러**:
   - Kotlin 또는 Java 소스 파일을 컴파일하여 .class 파일(바이트코드)을 생성한다. 이 단계에서 기본적인 심벌 해석이 이루어진다.

2. **DEX 변환(d8 또는 dx)**:
   - 여러 개의 .class 파일을 하나의 DEX 파일로 변환한다. 이 과정에서 여러 클래스와 메서드가 결합되며, 최적화 작업도 수행된다. 이는 전통적인 링커가 하는 "파일 결합" 작업에 해당한다.
   - DEX 변환 과정에서는 JVM 바이트코드를 안드로이드 런타임(ART)에서 실행할 수 있는 DEX 형식으로 변환한다.

3. **리소스 합치기 및 패키징(aapt)**:
   - **앱에서 사용하는 모든 리소스(XML 파일, 이미지 등)를 처리하여 하나의 패키지로 결합**한다. 이 작업은 APK 파일 생성 과정의 일부로 수행된다.
   - **aapt(Android Asset Packaging Tool)는 리소스를 결합하고 APK 파일로 패키징하는 역할**을 한다.

4. **APK 패키징**:
   - DEX 파일, 리소스 파일, AndroidManifest.xml, 네이티브 라이브러리 등을 모두 하나의 APK 파일로 패키징한다. 이 단계에서 모든 파일이 결합되어 최종 배포 가능한 파일이 생성된다.
   - APK 패키징은 전통적인 링커가 파일을 결합하여 실행 파일을 생성하는 것과 비슷한 작업이다.

## AndroidRuntime (ART)
AndroidRuntime(ART)는 안드로이드 운영체제에서 애플리케이션을 실행하기 위한 런타임 환경이다. ART는 안드로이드 5.0 롤리팝(Lollipop)부터 기본 런타임으로 도입되었으며, 이전에 사용되던 Dalvik이라는 런타임을 대체한다.

주요 특징:
1. Ahead-of-Time (AOT) 컴파일:
- ART는 Ahead-of-Time 컴파일 방식을 사용한다. 이는 앱이 설치될 때 미리 바이트코드를 기계어로 컴파일하는 방식이다. 이로 인해 앱 실행 시점에서 더 빠르게 실행될 수 있다. 반면, 이전의 Dalvik은 Just-In-Time (JIT) 컴파일 방식을 사용하여 앱 실행 중에 바이트코드를 컴파일했다.
2. 향상된 성능:
- ART는 Dalvik에 비해 성능이 개선되었다. 메모리 관리, 가비지 컬렉션(Garbage Collection), 코드 최적화 등에서 많은 향상이 이루어졌다. 그 결과, 앱의 실행 속도와 효율성이 더 좋아졌다.
3. 향상된 메모리 관리:
- ART는 Garbage Collection(GC) 과정에서 애플리케이션 중단 시간을 최소화하는 기술을 사용한다. 이는 앱 실행 중 느려지거나 일시적으로 멈추는 현상을 줄여준다.
4. 향상된 디버깅 기능:
- ART는 더 나은 디버깅, 프로파일링, 모니터링 기능을 제공한다. 예를 들어, 앱 실행 중의 성능 분석이 더 정밀하게 가능하다.

### ART는 가상 머신이자 런타임 환경이다
런타임 환경(runtime environment)은 프로그램이나 애플리케이션이 실행되는 동안 필요한 모든 기능을 제공하는 소프트웨어 환경을 의미한다. 이 환경은 프로그램이 제대로 실행되고, 작동하며, 사용자와 상호작용할 수 있도록 지원한다.

런타임 환경의 주요 구성 요소:
1. 가상 머신(Virtual Machine): 예를 들어, 자바 프로그램은 JVM(Java Virtual Machine)에서 실행되고, 안드로이드의 경우, AndroidRuntime(ART)가 이 역할을 한다. 가상 머신은 특정 운영체제나 하드웨어에 구애받지 않고 프로그램을 실행할 수 있도록 중개 역할을 한다.
2. 라이브러리: 프로그램이 실행될 때 필요한 코드와 함수들이 포함된 라이브러리들이 포함된다. 예를 들어, 문자열 처리, 파일 입출력, 네트워크 통신 등의 기능을 제공하는 표준 라이브러리들이 런타임 환경에 포함된다.
3. 메모리 관리: 프로그램이 실행될 때 사용하는 메모리를 할당하고 해제하는 기능을 제공한다. 예를 들어, 가비지 컬렉션(Garbage Collection)이라는 메모리 관리 기능이 런타임 환경에서 수행된다.
4. 예외 처리: 프로그램이 실행되는 동안 발생하는 오류나 예외를 처리하는 기능을 제공한다. 이를 통해 프로그램이 비정상 종료되는 것을 방지하고, 적절한 오류 메시지를 사용자에게 전달할 수 있다.
5. 시스템 호출 인터페이스: 운영체제와 상호작용하기 위해 프로그램이 시스템 자원(예: 파일 시스템, 네트워크, 장치 등)을 사용할 수 있도록 하는 인터페이스를 제공한다.

런타임 환경은 프로그램이 개발자 의도대로 동작할 수 있도록 하드웨어 및 운영체제와의 복잡한 상호작용을 관리해 준다. 개발자는 특정 하드웨어나 운영체제에 대한 세부 사항을 신경 쓰지 않고, 프로그램이 실행될 수 있는 표준화된 환경을 제공받게 된다.
예를 들어, 안드로이드의 ART는 안드로이드 애플리케이션이 실행되는 동안 메모리 관리, 쓰레드 관리, 가비지 컬렉션, 예외 처리 등을 담당하여 앱이 올바르게 동작할 수 있도록 지원한다. 이처럼 런타임 환경은 프로그램이 실행되는 동안 필수적인 여러 기능을 제공함으로써, 개발자가 애플리케이션을 실행하고 유지하는 데 도움을 준다.