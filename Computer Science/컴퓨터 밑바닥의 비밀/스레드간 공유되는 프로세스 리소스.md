# 스레드간 공유되는 프로세스 리소스

## 스레드 전용 리소스(thread-private resources)
- 상태 변화 관점에서 보면 스레드는 사실 함수 실행이다. CPU는 하나의 진입 함수의 명령어를 실행해서 실행 흐름인 스레드를 형성하기 때문이다.
- 그렇다면 바로 함수 실행에 필요한 정보가 스레드 전용 리소스라는 뜻이다.
- 함수의 실행 시간 정보는 스택 영역을 구성하는 스택 프레임에 저장된다. 이때 스택 프레임에는 함수의 반환값, 다른 함수를 호출할 때 전달되는 매개변수, 함수 내에서 사용되는 지역 변수와 레지스터 정보가 저장된다.
- 각 스레드는 자신만 사용할 수 있는 스택 영역을 가지므로, 스레드가 여러 개 있을 때는 여러 스택 영역이 존재하게 되는 것이다.
- 스택 영역 외에는 다음에 실행될 명령어 주소를 저장하는 PC 레지스터(register), 스레드 스택 영역에서 스택 상단(setack top) 위치를 저장하는 스택 포인터(stack pointer) 등 CPU가 기계 명령어를 실행할 때 내부 레지스터 값도 스레드의 현재 실행 상태에 속한다. 이런 레지스터 정보도 역시 스레드 전용으로, 다른 스레드에서는 이런 레지스터 정보에 접근할 수 없다.
- 스레드 상황 정보(thread context): 스레드에 속한 스택 영역, 프로그램 카운터, 스택 포인터, 함수 실행 시 사용되는 레지스터 정보를 통틀어 스레드 상황 정보(thread context)라고 한다.
- 전용 리소스를 제외한 나머지는 모두 스레드 간에 공유되는 리소스에 해당한다. 즉, 스레드는 프로세스 주소 공간에서 스택 영역을 제외한 나머지 영역(힙, 데이터, 코드)를 모두 공유한다. 

## 코드 영역: 모든 함수를 스레드에 배치하여 실행할 수 있다
- 프로세스 주소 공간의 코드 영역에는 컴파일 후 생성된 실행 가능한 기계 명령어가 저장된다. 이런 기계 명령어는 실행 파일에 저장되어 있으며, 프로그램이 시작될 때 프로세스 주소 공간에 적재된다.
- 코드 영역을 스레드간에 공유되므로 어떤 함수든지 모두 스레드에 적재하여 실행할 수 있고, 특정 함수를 특정 스레드에서만 실행되도록 하는 것은 불가능하다. 따라서 코드 영역은 모든 스레드가 공유하는 영역이다.
- 코드 영역은 읽기 전용(read-only)이기 때문에, 프로그램이 실행되는 동안에는 어떤 스레드도 코드 영역 내용을 변경할 수는 없다. 따라서 프로세스 내 모든 스레드가 코드 영역을 공유하고 있지만, 코드 영역에 관해서는 스레드 안전 문제(thread safety issue)가 발생하지 않는다. 

## 데이터 영역: 모든 스레드가 데이터 영역의 변수에 접근할 수 있다
- 데이터 영역은 전역 변수가 저장되는 곳이다.
- 프로그램이 실행되는 동안 데이터 영역 내에 전역 변수의 인스턴스(instance)는 하나만 있기 때문에, 모든 스레드는 이 전역 변수에 접근할 수 있다.
- 다시 말해, 어떤 스레드가 이 전역 변수 값을 변경하면, 이후 다른 스레드에서 이 전역 변수 값을 확인해도 변경된 상태라는 의미이다.

